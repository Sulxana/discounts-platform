@model Discounts.Mvc.Models.HomeViewModel

@{
    ViewData["Title"] = "Home - Discover the Best Deals";
}

<div class="page-wrapper">
    <!-- Hero Section -->
    <div class="hero-section">
        <div class="hero-badge">
            &#10038; NEW OFFERS DAILY
        </div>
        <h1 class="hero-title">
            Discover the <span class="accent">Best<br>Deals</span> in One Place.
        </h1>
        <p class="hero-subtitle">
            Join thousands of smart shoppers saving money every day with exclusive coupons, flash sales, and verified discount codes from your favorite brands.
        </p>
        <div class="hero-buttons">
            <a href="#offers" class="btn-hero-white">Explore Deals &rarr;</a>
            <a asp-controller="MerchantOffers" asp-action="Index" class="btn-hero-dark">Submit an Offer</a>
        </div>
    </div>

    <!-- Featured Offers Header -->
    <div id="offers">
        <div class="featured-row">
            <h3 class="featured-title">
                Featured Offers
                <span class="offer-count-badge">@Model.Offers.Count()</span>
            </h3>
        </div>

        <!-- Category Pills + Sort Row -->
        <div class="filter-sort-row">
            <div class="category-pills">
                <a asp-action="Index"
                   class="pill-btn @(string.IsNullOrEmpty(Model.Category) ? "active" : "")">All</a>
                @foreach (var cat in Model.Categories)
                {
                    <a asp-action="Index" asp-route-categoryName="@cat.Name"
                       asp-route-searchTerm="@Model.SearchTerm"
                       asp-route-sortBy="@Model.SortBy"
                       class="pill-btn @(Model.Category == cat.Name ? "active" : "")">@cat.Name</a>
                }
            </div>

            <div class="sort-control">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <line x1="21" y1="6" x2="3" y2="6"/><line x1="15" y1="12" x2="3" y2="12"/><line x1="9" y1="18" x2="3" y2="18"/>
                </svg>
                Sort by:
                <form method="get" asp-action="Index" id="sortForm" style="display:inline;">
                    <input type="hidden" name="categoryName" value="@Model.Category" />
                    <input type="hidden" name="searchTerm" value="@Model.SearchTerm" />
                    @{
                        var sortOptions = new[]
                        {
                            new SelectListItem("Newest",          "newest",   Model.SortBy == "newest"   || string.IsNullOrEmpty(Model.SortBy)),
                            new SelectListItem("Expiring Soon",   "expiring", Model.SortBy == "expiring"),
                            new SelectListItem("Biggest Discount","discount", Model.SortBy == "discount"),
                        };
                    }
                    <select name="sortBy" onchange="document.getElementById('sortForm').submit()">
                        @foreach (var opt in sortOptions)
                        {
                            if (opt.Selected)
                            {
                                <option value="@opt.Value" selected>@opt.Text</option>
                            }
                            else
                            {
                                <option value="@opt.Value">@opt.Text</option>
                            }
                        }
                    </select>
                </form>
            </div>
        </div>

        <!-- Offers Grid -->
        @if (!Model.Offers.Any())
        {
            <div class="empty-state">
                <h5>No offers found</h5>
                <p>Try changing your filters or check back later for new deals.</p>
            </div>
        }
        else
        {
            <div class="offers-grid">
                @foreach (var offer in Model.Offers)
                {
                    <div class="offer-card">
                        <!-- Image -->
                        <div class="card-img-wrap">
                            @if (!string.IsNullOrEmpty(offer.ImageUrl))
                            {
                                <img src="@offer.ImageUrl" alt="@offer.Title" />
                            }
                            else
                            {
                                <div class="card-img-placeholder">No Image</div>
                            }

                            <!-- Top-left badges -->
                            <div class="img-badges-tl">
                                <span class="badge-cat">@offer.Category?.ToUpper()</span>
                            </div>

                            <!-- Bottom-right badge: discount -->
                            @{
                                var hasDiscount = offer.OriginalPrice > 0 && offer.DiscountedPrice > 0 && offer.OriginalPrice > offer.DiscountedPrice;
                                var discountPct = hasDiscount
                                    ? (int)Math.Round((1 - (offer.DiscountedPrice / offer.OriginalPrice)) * 100)
                                    : 0;
                            }
                            @if (hasDiscount)
                            {
                                <span class="img-badge-br">@discountPct% OFF</span>
                            }
                        </div>

                        <!-- Card Body -->
                        <div class="card-body-custom">
                            <!-- Merchant row -->
                            <div class="merchant-row">
                                <span class="merchant-name">
                                    <span class="merchant-avatar">@(string.IsNullOrEmpty(offer.MerchantName) ? "M" : offer.MerchantName[0].ToString().ToUpper())</span>
                                    @offer.MerchantName
                                    <span class="verified-icon">&#10003;</span>
                                </span>
                                <span class="rating-chip">
                                    <span class="star-icon">&#9733;</span>
                                    @offer.RemainingCoupons left
                                </span>
                            </div>

                            <!-- Title + desc -->
                            <div class="offer-title">@offer.Title</div>
                            
                            <div class="card-price-row mt-2">
                                <span class="discount-price text-success fw-bold fs-5">@offer.DiscountedPrice.ToString("C")</span>
                                @if (hasDiscount)
                                {
                                    <span class="original-price text-muted text-decoration-line-through ms-2 small">@offer.OriginalPrice.ToString("C")</span>
                                }
                            </div>

                            <!-- Footer -->
                            <div class="card-footer-custom">
                                <span class="expiry-info">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                    Exp. @offer.EndDate.ToString("MMM dd")
                                </span>
                                <a asp-controller="Offers" asp-action="Details" asp-route-id="@offer.Id" class="btn-get-deal">
                                    Get Deal &#8599;
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>

            <!-- Pagination -->
            <div class="pagination-row">
                @if (Model.CurrentPage > 1)
                {
                    <a asp-action="Index"
                       asp-route-page="@(Model.CurrentPage - 1)"
                       asp-route-searchTerm="@Model.SearchTerm"
                       asp-route-categoryName="@Model.Category"
                       asp-route-sortBy="@Model.SortBy"
                       class="btn-page">&larr; Previous</a>
                }
                else
                {
                    <div></div>
                }

                @if (Model.HasNextPage)
                {
                    <a asp-action="Index"
                       asp-route-page="@(Model.CurrentPage + 1)"
                       asp-route-searchTerm="@Model.SearchTerm"
                       asp-route-categoryName="@Model.Category"
                       asp-route-sortBy="@Model.SortBy"
                       class="btn-page">Next &rarr;</a>
                }
                else
                {
                    <div></div>
                }
            </div>
        }
    </div>
</div>
